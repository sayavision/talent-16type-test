<!doctype html>
<html lang="ja">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>才能診断（質問ページ）</title>
  <style>
    :root{ --bg:#0b1020; --card:#111a33; --txt:#e9ecf4; --muted:#a9b2cc; --line:rgba(255,255,255,.10); --accent:#7aa2ff; }
    body{ margin:0; font-family: system-ui, -apple-system, Segoe UI, Roboto, "Noto Sans JP", sans-serif;
      background: linear-gradient(180deg,#0b1020,#070a12); color:var(--txt); }
    .wrap{ max-width:920px; margin:0 auto; padding:24px; }
    .card{ background: rgba(17,26,51,.92); border:1px solid rgba(255,255,255,.08); border-radius:18px; padding:18px; box-shadow:0 12px 30px rgba(0,0,0,.25); }
    .row{ display:flex; gap:14px; flex-wrap:wrap; align-items:center; justify-content:space-between; }
    .pill{ display:inline-block; padding:6px 10px; border-radius:999px; border:1px solid rgba(255,255,255,.14); color:var(--muted); font-size:12px; }
    .hr{ height:1px; background:var(--line); margin:14px 0; }
    h1{ font-size:20px; margin:0 0 8px; }
    p{ margin:8px 0; color:var(--muted); line-height:1.7; }
    .q{ font-weight:800; margin:10px 0; }
    .opt{ display:block; width:100%; text-align:left; padding:12px 12px; margin:10px 0;
      border-radius:12px; border:1px solid rgba(255,255,255,.12); background: rgba(255,255,255,.04); color:var(--txt); cursor:pointer; }
    .opt:hover{ border-color: rgba(122,162,255,.6); }
    .btn{ background: var(--accent); color:#07102a; border:0; padding:10px 14px; border-radius: 12px; font-weight: 800; cursor:pointer; }
    .btn.sub{ background: transparent; color: var(--txt); border: 1px solid rgba(255,255,255,.14); }
    input{ width:100%; box-sizing:border-box; padding:10px 12px; border-radius:12px;
      border:1px solid rgba(255,255,255,.14); background: rgba(255,255,255,.04); color:var(--txt); }
    label{ display:block; margin:10px 0 6px; color:var(--muted); font-size:12px; }
    .small{ font-size:12px; color:var(--muted); }
  </style>
</head>

<body>
<div class="wrap">

  <div class="card" id="screenStart">
    <h1>才能診断（質問ページ）</h1>
    <p>ここがトップURL（/）で表示される「質問ページ」です。最後まで答えると result.html に遷移します。</p>

    <div class="hr"></div>

    <div class="row">
      <div style="flex:1; min-width:260px;">
        <h1 style="font-size:16px; margin:0 0 6px;">ホロスコープ（任意）</h1>
        <label>太陽星座（例：Gemini）</label>
        <input id="sun" placeholder="Gemini / Aries / etc">
        <label>月星座（例：Leo）</label>
        <input id="moon" placeholder="Leo / Cancer / etc">
        <label>ASC（例：Libra）</label>
        <input id="asc" placeholder="Libra / Virgo / etc">
        <p class="small">※ここは“入力を結果へ渡す”だけ。計算は後でOK。</p>
      </div>

      <div style="flex:1; min-width:260px;">
        <p class="pill">画像は同階層に置いてOK</p>
        <p class="small">element_earth.png / element_fire.png / element_air.png / element_water.png</p>
        <button class="btn" id="btnStart">診断スタート</button>
        <button class="btn sub" id="btnGoResult" style="margin-left:8px;">結果ページだけ開く</button>
      </div>
    </div>
  </div>

  <div class="card" id="screenQuiz" style="display:none;">
    <div class="row">
      <div class="pill" id="progress">Q1 / 16</div>
      <button class="btn sub" id="btnReset">最初から</button>
    </div>
    <div class="hr"></div>

    <div class="q" id="qText"></div>
    <div id="options"></div>

    <p class="small">※質問文と配点は後で差し替えOK。今は「遷移が動く完成形」を作っています。</p>
  </div>

</div>

<script>
  // ======================
  // 16才能（固定％の辞書）
  // ※現時点では「最終結果の表示内容」を優先して、この並びを結果に渡します。
  // ======================
  const TALENTS_FIXED = [
    { name:"学習探究", pct:92, desc:"興味を持ったテーマをとことん深く学び、知識として蓄えていく才能。" },
    { name:"アイディア", pct:88, desc:"いろんな知識や経験をつなぎ合わせて、新しいアイデアを生み出す才能。" },
    { name:"仕組み", pct:80, desc:"物事を仕組み化・ルール化して、“勝手に回る状態”をつくる才能。" },
    { name:"本質", pct:76, desc:"表面的な情報にとらわれず、「結局いちばん大事なポイント」を見抜く才能。" },
    { name:"整理整頓", pct:70, desc:"ごちゃついた状態を分類・整理し、スッキリ使いやすい形に整え直す才能。" },
    { name:"ビジョン", pct:68, desc:"自分なりの価値観をもとに、進みたい方向や未来のイメージを描く才能。" },
    { name:"寄り添い", pct:65, desc:"相手の感情の深いところを感じ取り、その人のペースで支える才能。" },
    { name:"調和", pct:63, desc:"人と人の摩擦を和らげ、安心・安全な空気をつくる才能。" },
    { name:"育成", pct:60, desc:"小さな成長の芽を見つけ、信じて伴走し続ける才能。" },
    { name:"バランス", pct:58, desc:"チーム全体を見ながら、負担や役割のバランスを整える才能。" },
    { name:"目標達成", pct:55, desc:"決めたゴールに向かって粘り強く進み、達成まで持っていく才能。" },
    { name:"修復", pct:52, desc:"うまくいかなくなった物事を立て直し、もう一度動き出すように整える才能。" },
    { name:"開放", pct:48, desc:"場の空気をふわっと明るくし、人の心をオープンにしていく才能。" },
    { name:"表現", pct:45, desc:"言葉や表情・表現を通して、自分の内側を外に届ける才能。" },
    { name:"求心", pct:42, desc:"「この指とまれ」で人を自然と集め、仲間を増やしていく才能。" },
    { name:"先導", pct:38, desc:"人より半歩先に立って、「こっちへ行こう」と道を示す才能。" },
  ];

  // ======================
  // 質問（16問）※仮
  // A/Bで「4フィールド」に加点するだけの簡易版
  // 後で才能16に紐づける配点に差し替え可能
  // ======================
  const QUESTIONS = Array.from({length:16}).map((_,i)=>{
    const n = i+1;
    const fields = ["EARTH","FIRE","AIR","WATER"];
    const aField = fields[i % 4];
    const bField = fields[(i+1) % 4];
    return {
      text: `Q${n}. 直感で近い方を選んでください`,
      options: [
        { label:"A：計画して積み上げる", field:aField },
        { label:"B：ひらめきで動きながら整える", field:bField },
      ]
    };
  });

  // 状態
  let idx = 0;
  let fieldScore = { EARTH:0, FIRE:0, AIR:0, WATER:0 };

  // 画面
  const screenStart = document.getElementById("screenStart");
  const screenQuiz  = document.getElementById("screenQuiz");
  const progress    = document.getElementById("progress");
  const qText       = document.getElementById("qText");
  const optionsEl   = document.getElementById("options");

  document.getElementById("btnGoResult").addEventListener("click", ()=>{
    location.href = "./result.html";
  });

  document.getElementById("btnStart").addEventListener("click", ()=>{
    idx = 0;
    fieldScore = { EARTH:0, FIRE:0, AIR:0, WATER:0 };
    screenStart.style.display = "none";
    screenQuiz.style.display = "block";
    renderQ();
  });

  document.getElementById("btnReset").addEventListener("click", ()=> location.reload());

  function renderQ(){
    const q = QUESTIONS[idx];
    progress.textContent = `Q${idx+1} / ${QUESTIONS.length}`;
    qText.textContent = q.text;
    optionsEl.innerHTML = "";

    q.options.forEach(opt=>{
      const btn = document.createElement("button");
      btn.className = "opt";
      btn.textContent = opt.label;
      btn.addEventListener("click", ()=>{
        fieldScore[opt.field] += 1;
        idx += 1;
        if (idx >= QUESTIONS.length){
          finish();
        } else {
          renderQ();
        }
      });
      optionsEl.appendChild(btn);
    });
  }

  function finish(){
    // 4フィールドを％に正規化（合計100）
    const total = Object.values(fieldScore).reduce((a,b)=>a+b,0) || 1;
    const fieldsPct = {};
    Object.keys(fieldScore).forEach(k=>{
      fieldsPct[k] = Math.round((fieldScore[k] / total) * 100);
    });

    // メインフィールド
    const mainField = Object.entries(fieldScore).sort((a,b)=>b[1]-a[1])[0][0];

    // ホロ入力
    const horoscope = {
      sun:  document.getElementById("sun").value.trim(),
      moon: document.getElementById("moon").value.trim(),
      asc:  document.getElementById("asc").value.trim(),
    };

    // ✅ここが最終盤：結果を保存して result.html に遷移
    const result = {
      mainField,
      fields: fieldsPct,
      talents: TALENTS_FIXED,   // まずは確定％をそのまま渡す（後で診断連動に変えられる）
      horoscope
    };

    localStorage.setItem("talentResult", JSON.stringify(result));
    location.href = "./result.html";
  }
</script>
</body>
</html>
