<!DOCTYPE html>
<html lang="ja">
<head>
  <meta charset="UTF-8">
  <title>才能8軸診断＋星エレメント16タイプ（ベータ）</title>
  <meta name="viewport" content="width=device-width, initial-scale=1">

  <!-- Chart.js -->
  <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>

  <style>
    body {
      font-family: system-ui, -apple-system, BlinkMacSystemFont, "Segoe UI", sans-serif;
      max-width: 900px;
      margin: 0 auto;
      padding: 16px;
      line-height: 1.7;
      background: #f7f7fb;
    }
    h1 {
      font-size: 1.4rem;
      margin-bottom: 0.5rem;
    }
    .card {
      background: #fff;
      border-radius: 12px;
      padding: 16px 18px;
      margin: 12px 0;
      box-shadow: 0 4px 12px rgba(0,0,0,0.04);
    }
    .question {
      margin-bottom: 16px;
      padding-bottom: 12px;
      border-bottom: 1px solid #eee;
    }
    .question:last-child {
      border-bottom: none;
      padding-bottom: 0;
    }
    .question-title {
      font-weight: 600;
      margin-bottom: 6px;
    }
    .options {
      display: flex;
      flex-wrap: wrap;
      gap: 8px;
      font-size: 0.9rem;
    }
    label.option {
      display: inline-flex;
      align-items: center;
      gap: 4px;
      padding: 4px 8px;
      border-radius: 999px;
      border: 1px solid #ddd;
      cursor: pointer;
      background: #fafafa;
    }
    input[type="radio"] {
      cursor: pointer;
    }
    button {
      border: none;
      border-radius: 999px;
      padding: 10px 18px;
      font-size: 1rem;
      font-weight: 600;
      cursor: pointer;
      background: #4b7bec;
      color: white;
      margin-top: 8px;
    }
    button:disabled {
      opacity: 0.6;
      cursor: default;
    }
    .small {
      font-size: 0.85rem;
      color: #666;
    }
    .result-title {
      font-weight: 600;
      margin-bottom: 4px;
    }
    .axis-row {
      display: flex;
      align-items: center;
      justify-content: space-between;
      gap: 8px;
      margin: 6px 0;
      font-size: 0.95rem;
    }
    .axis-label {
      min-width: 190px;
    }
    .axis-bar-wrap {
      flex: 1;
      background: #f0f0f5;
      border-radius: 999px;
      overflow: hidden;
      height: 10px;
    }
    .axis-bar {
      height: 100%;
      width: 0%;
      transition: width 0.4s;
    }
    .axis-percent {
      min-width: 40px;
      text-align: right;
      font-variant-numeric: tabular-nums;
    }
    .badge {
      display: inline-block;
      font-size: 0.75rem;
      padding: 2px 8px;
      border-radius: 999px;
      background: #eef2ff;
      color: #3730a3;
      margin-left: 4px;
    }
    input[type="date"] {
      padding: 4px 8px;
      border-radius: 999px;
      border: 1px solid #ccc;
      font-size: 0.9rem;
      margin-left: 4px;
    }
  </style>
</head>
<body>

  <!-- タイトル -->
  <div class="card">
    <h1>才能8軸診断＋星エレメント16タイプ（ベータ）</h1>
    <p class="small">
      あなたの中にある<strong>4つのエレメント</strong>（EARTH／FIRE／AIR／WATER）を、さらに8つの軸に分けて見ていきます。<br>
      48個の質問に、直感で1〜5を選んでください。
    </p>
    <p class="small">
      1：まったく当てはまらない／2：あまり当てはまらない／3：どちらともいえない／4：かなり当てはまる／5：とても当てはまる
    </p>
  </div>

  <!-- 生年月日入力 -->
  <div class="card">
    <div class="result-title">生年月日の入力（任意）</div>
    <p class="small">
      星とのかけ合わせ診断のために、生年月日を教えてください。<br>
      ここからあなたの<strong>12星座</strong>と<strong>星のエレメント</strong>を読み取ります。
    </p>
    <p class="small">
      生年月日：
      <input type="date" id="birthDate">
    </p>
    <p class="small">
      ※入力しなくても、才能8軸の結果は表示されます。<br>
      ※生年月日を入れると「星×才能」の16タイプ結果と12星座メッセージが出ます。
    </p>
  </div>

  <!-- 質問フォーム -->
  <form id="quizForm" class="card">
    <div id="questionsContainer"></div>
    <button type="submit">結果を見る</button>
    <p class="small">※すべての質問に回答してからボタンを押してください。</p>
  </form>

  <!-- 結果表示 -->
  <div id="resultCard" class="card" style="display:none;">
    <div id="resultContent"></div>

    <!-- 結果シェア -->
    <div id="resultShare" style="margin-top:12px;">
      <button type="button" id="copyResultBtn">結果テキストをコピー</button>
      <button type="button" id="shareResultBtn">結果をシェア</button>
      <p id="shareMessage" class="small"></p>
    </div>

    <hr style="margin:14px 0;">
    <div class="result-title">4エレメントのレーダーチャート</div>
    <p class="small">全体のバランスを感覚的に眺めてみてください。</p>
    <canvas id="domainRadar" style="max-width: 100%;"></canvas>

    <!-- 4エレメントマップ -->
    <hr style="margin:16px 0;">
    <div class="result-title">4エレメントマップ</div>
    <p class="small">
      EARTH（左下）・FIRE（右下）・AIR（右上）・WATER（左上）の四角いマップの中で、<br>
      あなたの今のバランスがどのあたりに位置しているかを点で示しています。
    </p>
    <canvas id="elementMap" style="max-width: 100%; height:260px;"></canvas>

    <!-- 星と才能のタイプ診断 -->
    <hr style="margin:16px 0;">
    <div id="astroSection">
      <div class="result-title">星と才能を合わせた16タイプ診断</div>
      <p class="small">
        生年月日から<strong>12星座</strong>と<strong>星のエレメント</strong>を判定し、才能エレメントとのかけ合わせでタイプを出します。<br>
        ※生年月日を入力していない場合、「星×才能」の結果は表示されません。
      </p>
      <div id="astroResultBox" class="small" style="margin-top:10px;"></div>
    </div>
  </div>

  <script>
    // ---- 8軸定義 ----
    const axes = {
      // EARTH：形にする領域
      X1: { id: "X1", label: "大地のデザイン軸", domain: "EARTH｜形にする領域" },
      X2: { id: "X2", label: "大地の実行軸",   domain: "EARTH｜形にする領域" },

      // FIRE：人と場を動かす領域
      I1: { id: "I1", label: "火の発信軸",     domain: "FIRE｜人と場を動かす領域" },
      I2: { id: "I2", label: "火の推進軸",     domain: "FIRE｜人と場を動かす領域" },

      // AIR：しくみを組む領域
      T1: { id: "T1", label: "風の分析軸",     domain: "AIR｜しくみを組む領域" },
      T2: { id: "T2", label: "風の探究軸",     domain: "AIR｜しくみを組む領域" },

      // WATER：絆を育てる領域
      R1: { id: "R1", label: "水の共感軸",     domain: "WATER｜絆を育てる領域" },
      R2: { id: "R2", label: "水のチーム軸",   domain: "WATER｜絆を育てる領域" }
    };

    const axisOrder = ["X1","X2","I1","I2","T1","T2","R1","R2"];

    // ---- 4エレメント説明 ----
    const domainDescriptions = {
      "EARTH｜形にする領域":
        "現実世界で一歩ずつ「形にしていく」エリア。計画を立てる・段取りする・やり切ることで、アイデアを現実の結果につなげていく領域です。",

      "FIRE｜人と場を動かす領域":
        "言葉や存在感で、人と場に火を灯すエリア。発信・説得・リーダーシップなどを通して、エネルギーを生み出し、周りを動かしていく領域です。",

      "AIR｜しくみを組む領域":
        "一歩引いた視点で全体を見渡し、「しくみ」や「意味」を組み立てるエリア。分析・学び・戦略づくりで、本質をとらえていく領域です。",

      "WATER｜絆を育てる領域":
        "人の心や関係性に水をそそぎ、ゆっくりと絆を育てていくエリア。共感・サポート・チームワークを通して、安心できるつながりをつくる領域です。"
    };

    // 色設定（EARTH=紫, FIRE=オレンジ, AIR=緑, WATER=水色）
    const domainColors = {
      "EARTH｜形にする領域": "#8B5CF6",
      "FIRE｜人と場を動かす領域": "#F97316",
      "AIR｜しくみを組む領域":   "#22C55E",
      "WATER｜絆を育てる領域":   "#38BDF8"
    };

    // 4隅マップ用の座標
    const elementPositions = {
      "EARTH｜形にする領域": { x: -1, y: -1 }, // 左下
      "FIRE｜人と場を動かす領域": { x:  1, y: -1 }, // 右下
      "AIR｜しくみを組む領域":   { x:  1, y:  1 }, // 右上
      "WATER｜絆を育てる領域":   { x: -1, y:  1 }  // 左上
    };

    const elementDisplayNames = {
      EARTH: "EARTH｜形にする領域",
      FIRE:  "FIRE｜人と場を動かす領域",
      AIR:   "AIR｜しくみを組む領域",
      WATER: "WATER｜絆を育てる領域"
    };

    const starElementLabels = {
      FIRE:  "FIRE（火）エレメント",
      EARTH: "EARTH（土）エレメント",
      AIR:   "AIR（風）エレメント",
      WATER: "WATER（水）エレメント"
    };

    // 8軸の短い説明（一覧用）
    const axisDescriptions = {
      X1: "やることを整理し、流れや手順を組み立てる力。段取り・仕組み化・土台づくりが得意な軸です。",
      X2: "決めたことを粘り強くやり切る力。コツコツ続ける・最後まで終わらせるところで力を発揮する軸です。",
      I1: "言葉や存在感で場を明るくする力。前に出て話したり、雰囲気をあたためたりする軸です。",
      I2: "人を納得させ、巻き込みながら前に進める力。推進役・まとめ役として働く軸です。",
      T1: "情報や出来事を整理し、構造化して考える力。ロジカルに分析して判断する軸です。",
      T2: "深く学び、探究し続ける力。知識や経験を蓄えて、自分なりに理解を深めていく軸です。",
      R1: "人の気持ちに気づき、そっと寄りそう力。1対1の信頼関係やケアで力を発揮する軸です。",
      R2: "人と一緒に進め、チームとしてうまく回す力。調整・サポート・チームビルディングの軸です。"
    };

    // 8軸の詳しいフィードバック（各軸用パラグラフ）
    const axisLongFeedback = {
      X1: "「大地のデザイン軸」が高いあなたは、物事を行き当たりばったりで進めるよりも、全体の流れや手順を組み立ててから動きたいタイプです。やることを整理したり、タスクを並べ替えたり、「この順番で進めるとスムーズ」と自然に組み立てていることが多いはず。頭の中で段取りを描きながら動くので、周りから見ると「準備が整っている人」「安心して任せられる人」として映りやすい才能です。プロジェクトの設計や、仕組みづくり、手順の整備などで力を発揮しやすい軸と言えます。",
      X2: "「大地の実行軸」が高いあなたは、一度「やる」と決めたことを途中で投げ出しにくい人です。途中で止まっているタスクがあると落ち着かなかったり、「どうせやるならちゃんと終わらせたい」と感じることが多いかもしれません。周りが飽きてきたころにも、コツコツと積み上げを続けられるので、長期プロジェクトや裏方で質を守るポジションで真価を発揮します。派手さよりも、確実に前に進める力があなたの大きな強みになっています。",
      I1: "「火の発信軸」が高いあなたは、言葉や表情、雰囲気そのものを使って場に火を灯す人です。沈んだ空気を変えたり、「こんなことやろうよ」と話題を投げかけたり、気づけば場の温度を上げている場面が多いはず。完璧なスピーチでなくても、日常の一言やSNSの投稿など、ライトな発信でも周りに影響を与えやすいタイプです。自分の感覚や経験をシェアすることで、人の背中をほんのり押していることが多い軸です。",
      I2: "「火の推進軸」が高いあなたは、人や場を巻き込みながら前に進めていく力を持っています。状況を見ながら「じゃあ、こうしてみよう」「とりあえずここまで進めよう」と流れをつくることができるので、気づくとプロジェクトの舵取り役になっていることも多いタイプです。迷っている人たちに「こっちに行ってみようか」と方向を示したり、場のエネルギーをぐっと前向きに変えていくところに、あなたならではの強さがあります。",
      T1: "「風の分析軸」が高いあなたは、感覚だけで決めるよりも「なぜそうなるのか」「他にどんな選択肢があるのか」を考えたくなる人です。情報や出来事を整理し、因果関係やパターンを見抜くのが得意で、複雑な状況をシンプルに捉え直すことができます。感情に流されにくいため、周囲の暴走を止めたり、リスクに早めに気づいたりする役割も担いやすいタイプです。「よく考える」「冷静に見ている」一面が、あなたの大きな強みになっています。",
      T2: "「風の探究軸」が高いあなたは、興味を持ったテーマをどこまでも深掘りしたくなる人です。「なぜ？」「どうしてそうなるの？」と考え始めると、自分でも止まらないと感じることがあるかもしれません。本や講座、実体験などを通してインプットしたものを、自分なりの言葉やノートで整理していくことが多く、その分野では自然と周りより詳しくなっていきます。知ること・理解が深まること自体を楽しめる軸です。",
      R1: "「水の共感軸」が高いあなたは、人の表情や声のトーン、ちょっとした沈黙の変化にも敏感に気づく人です。相手の内側で起きていることに耳を澄ましながら話を聴くので、「ちゃんとわかってくれる人」と感じてもらいやすいタイプです。アドバイスをする前に、まず受け止めることができるため、1対1の関係性の中で信頼を育てやすい才能を持っています。寄りそうことそのものが、あなたのギフトになっている軸です。",
      R2: "「水のチーム軸」が高いあなたは、誰か一人だけが目立つ場よりも、「みんなが気持ちよく動ける空気」をつくることに喜びを感じる人です。関係性全体のバランスを見ながら、自然にフォローや調整に回ることが多く、場がギスギスしているときに柔らかい一言を差し込んだり、裏側でサポート役に回ったりすることで、チーム全体のパフォーマンスを底上げしていきます。あたり前のようにやっている調整や声かけが、実は大きな価値になっている軸です。"
    };

    // ---- 12星座 ----
    const zodiacInfos = {
      ARIES:   { id:"ARIES",   name:"牡羊座", element:"FIRE",  description:"スタートダッシュ・チャレンジ精神・率直さがテーマになりやすい星座です。" },
      TAURUS:  { id:"TAURUS",  name:"牡牛座", element:"EARTH", description:"五感の心地よさや安定感、マイペースさを大切にする星座です。" },
      GEMINI:  { id:"GEMINI",  name:"双子座", element:"AIR",   description:"好奇心旺盛で、情報や会話を通じて世界を広げていく星座です。" },
      CANCER:  { id:"CANCER",  name:"蟹座",   element:"WATER", description:"身近な人や居場所を守り、あたたかい関係性を育てる星座です。" },
      LEO:     { id:"LEO",     name:"獅子座", element:"FIRE",  description:"自己表現やドラマチックさを通して、周りを照らしていく星座です。" },
      VIRGO:   { id:"VIRGO",   name:"乙女座", element:"EARTH", description:"細やかな気配りと実務力で、現場を整えることに長けた星座です。" },
      LIBRA:   { id:"LIBRA",   name:"天秤座", element:"AIR",   description:"バランス感覚と対話力で、人と人の間をつないでいく星座です。" },
      SCORPIO: { id:"SCORPIO", name:"蠍座",   element:"WATER", description:"物事や人と深く向き合い、本質に迫っていく力を持つ星座です。" },
      SAGITTARIUS:{id:"SAGITTARIUS",name:"射手座",element:"FIRE",description:"自由な探究心とスケールの大きなビジョンで、世界を広げていく星座です。"},
      CAPRICORN:{ id:"CAPRICORN",name:"山羊座", element:"EARTH",description:"目的達成に向けて、長期的にコツコツ積み上げていく星座です。" },
      AQUARIUS:{ id:"AQUARIUS", name:"水瓶座", element:"AIR",   description:"既存の枠にとらわれず、新しい価値観やつながりを生み出す星座です。" },
      PISCES:  { id:"PISCES",  name:"魚座",   element:"WATER", description:"感受性が豊かで、境界を超えて共感し、癒しをもたらす星座です。" }
    };

    function getZodiacFromBirthdate(dateStr) {
      if (!dateStr) return null;
      const parts = dateStr.split("-");
      if (parts.length < 3) return null;
      const month = parseInt(parts[1], 10);
      const day   = parseInt(parts[2], 10);
      if (!month || !day) return null;

      if ((month === 3 && day >= 21) || (month === 4 && day <= 19)) return zodiacInfos.ARIES;
      if ((month === 4 && day >= 20) || (month === 5 && day <= 20)) return zodiacInfos.TAURUS;
      if ((month === 5 && day >= 21) || (month === 6 && day <= 21)) return zodiacInfos.GEMINI;
      if ((month === 6 && day >= 22) || (month === 7 && day <= 22)) return zodiacInfos.CANCER;
      if ((month === 7 && day >= 23) || (month === 8 && day <= 22)) return zodiacInfos.LEO;
      if ((month === 8 && day >= 23) || (month === 9 && day <= 22)) return zodiacInfos.VIRGO;
      if ((month === 9 && day >= 23) || (month === 10 && day <= 23)) return zodiacInfos.LIBRA;
      if ((month === 10 && day >= 24) || (month === 11 && day <= 22)) return zodiacInfos.SCORPIO;
      if ((month === 11 && day >= 23) || (month === 12 && day <= 21)) return zodiacInfos.SAGITTARIUS;
      if ((month === 12 && day >= 22) || (month === 1 && day <= 19)) return zodiacInfos.CAPRICORN;
      if ((month === 1 && day >= 20) || (month === 2 && day <= 18)) return zodiacInfos.AQUARIUS;
      if ((month === 2 && day >= 19) || (month === 3 && day <= 20)) return zodiacInfos.PISCES;
      return null;
    }

    function getElementKeyFromDomainName(domainName) {
      if (!domainName) return null;
      if (domainName.startsWith("EARTH")) return "EARTH";
      if (domainName.startsWith("FIRE"))  return "FIRE";
      if (domainName.startsWith("AIR"))   return "AIR";
      if (domainName.startsWith("WATER")) return "WATER";
      return null;
    }

    // 星×才能 16タイプ（まずは一言メッセージ）
    const talentStarTypes = {
      "EARTH-EARTH": {
        title: "畑を耕す実行派タイプ",
        oneLine: "コツコツ土台をつくって、確実に結果を出していく人。"
      },
      "EARTH-FIRE": {
        title: "情熱を形にする実行タイプ",
        oneLine: "「これやりたい！」という火を、ちゃんと行動と成果につなげる人。"
      },
      "EARTH-AIR": {
        title: "設計図から形にする実行タイプ",
        oneLine: "頭の中のプランや構造を、そのまま現実の仕組みに落としていく人。"
      },
      "EARTH-WATER": {
        title: "思いやりで現場を整える実行タイプ",
        oneLine: "人の気持ちをくみとりながら、無理のない形で物事を進めていく人。"
      },

      "FIRE-FIRE": {
        title: "場を燃やすムードメーカータイプ",
        oneLine: "いるだけで場の温度が上がる、盛り上げ役＆火付け役。"
      },
      "FIRE-EARTH": {
        title: "地に足ついたリーダータイプ",
        oneLine: "現実感のある一言で、みんなをぐいっと前に進めるリーダー。"
      },
      "FIRE-AIR": {
        title: "言葉で火をつける発信タイプ",
        oneLine: "言葉やストーリーで、人の心に「やってみたい！」を灯す人。"
      },
      "FIRE-WATER": {
        title: "心に火を灯す応援タイプ",
        oneLine: "相手の気持ちに寄りそいながら、「一歩出てみようよ」と背中を押す人。"
      },

      "AIR-FIRE": {
        title: "アイデアで場を動かす企画タイプ",
        oneLine: "おもしろい企画や工夫で、人や場をワクワクさせる人。"
      },
      "AIR-EARTH": {
        title: "現実を整える設計タイプ",
        oneLine: "混ざった状況を整理して、仕組みやルールに落とし込む人。"
      },
      "AIR-AIR": {
        title: "本質を読み解くナビゲータータイプ",
        oneLine: "情報の中からツボを見抜き、「結局ここが大事」と方向を示す人。"
      },
      "AIR-WATER": {
        title: "物語を聴き出すストーリー編集タイプ",
        oneLine: "相手の話の中から、その人らしい物語やメッセージを引き出す人。"
      },

      "WATER-FIRE": {
        title: "情熱を支える伴走タイプ",
        oneLine: "ガツガツ前に出るより、情熱的な人の隣で支えながら一緒に走る人。"
      },
      "WATER-EARTH": {
        title: "現場をあたためるケアタイプ",
        oneLine: "チームや場のコンディションを見ながら、安心して動ける環境を整える人。"
      },
      "WATER-AIR": {
        title: "対話で場を整えるファシリタイプ",
        oneLine: "対話を通して、一人ひとりの声を拾いながら場をまとめていく人。"
      },
      "WATER-WATER": {
        title: "安心感でつなぐコネクタータイプ",
        oneLine: "「ここにいるとホッとする」と感じる人と人を、やわらかくつないでいく人。"
      }
    };

    // 上位3軸の掛け合わせメッセージ（共通テンプレ）
    function buildTop3CombinationMessage(top3) {
      if (!top3 || top3.length === 0) return "";
      const names = top3.map(a => a.label);
      return `あなたの今のメインの才能は「${names.join("」「")}」の3つです。これは、あなたが無意識に使っている才能であり、「頑張らなくても自然と活用できる」領域でもあります。この3つは、それぞれ単体でも力を持っていますが、同時に働くことであなたならではのリズムとスタイルをつくります。日常の中で「しっくりくる動き方」や「つい引き受けがちな役割」を思い出してみると、そこには必ずこの3つの軸のエッセンスが重なっています。`;
    }

    function buildZodiacTalentMessage(zodiac, talentName) {
      if (!zodiac || !talentName) return "";
      return `「${zodiac.name}」が持つテーマに「${talentName}」のエネルギーが重なることで、あなたは自分らしい形で才能を発揮しやすいタイプです。星の気質を否定せず、そのまま活かすつもりで、強みが自然に使える環境や関わり方を選んでいくと、日常の中で少しずつ「ちょうどいい自分のペース」が見つかっていきます。`;
    }

    // ---- 質問定義 ----
    const questions = [
      // X1 大地のデザイン軸
      { id: 1, axis: "X1", text: "やることを紙やアプリにリスト化してから行動することが多い。" },
      { id: 2, axis: "X1", text: "物事を進める前に、手順や流れを整理したくなる。" },
      { id: 3, axis: "X1", text: "「この順番でやると効率がいい」と考えながら動いている。" },
      { id: 4, axis: "X1", text: "仕事や家事のやり方を、もっと楽になるように工夫するのが好きだ。" },
      { id: 5, axis: "X1", text: "みんなが迷わないように、ルールや仕組みを整えたくなる。" },
      { id: 6, axis: "X1", text: "ゴールから逆算してスケジュールを組むのが得意だと感じる。" },

      // X2 大地の実行軸
      { id: 7, axis: "X2", text: "途中で投げ出すのが嫌で、つい最後までやり切ってしまう。" },
      { id: 8, axis: "X2", text: "締め切りが近づくと、むしろ集中力が高まるほうだ。" },
      { id: 9, axis: "X2", text: "「途中までやって放置」が気持ち悪く感じる。" },
      { id: 10, axis: "X2", text: "大変でも、一度引き受けたことはやり遂げたいと思う。" },
      { id: 11, axis: "X2", text: "人から頼まれたことを忘れないよう、きちんと終わらせようとする。" },
      { id: 12, axis: "X2", text: "長期的なプロジェクトでも、コツコツ続けることができる。" },

      // I1 火の発信軸
      { id: 13, axis: "I1", text: "人前で話すことに、そこまで強い抵抗はない。" },
      { id: 14, axis: "I1", text: "自分の考えや経験を、SNSやブログなどで発信したくなる。" },
      { id: 15, axis: "I1", text: "場が静かすぎると、つい話題を振ったり盛り上げたりしてしまう。" },
      { id: 16, axis: "I1", text: "自分の意見をハッキリ言う方だと思う。" },
      { id: 17, axis: "I1", text: "初対面の人とも、わりとすぐに会話を広げられる。" },
      { id: 18, axis: "I1", text: "「あなたがいると場の雰囲気が明るくなる」と言われたことがある。" },

      // I2 火の推進軸
      { id: 19, axis: "I2", text: "みんなの意見を聞いたうえで、「じゃあこうしよう」と方向性を示すことが多い。" },
      { id: 20, axis: "I2", text: "企画やアイデアを、人に分かりやすくプレゼンするのが好きだ。" },
      { id: 21, axis: "I2", text: "相手に納得してもらえる説明の仕方を考えるのが得意だ。" },
      { id: 22, axis: "I2", text: "チームや周囲を巻き込みながら、物事を前に進めるのが好きだ。" },
      { id: 23, axis: "I2", text: "自分がいいと思ったものは、人にも勧めたくなる。" },
      { id: 24, axis: "I2", text: "会議や話し合いで、最終的に結論をまとめる役割になることが多い。" },

      // T1 風の分析軸
      { id: 25, axis: "T1", text: "情報を聞いたとき「なぜそうなるのか？」を考えたくなる。" },
      { id: 26, axis: "T1", text: "問題が起きると、原因を分析して再発防止策を考える。" },
      { id: 27, axis: "T1", text: "データや数字を見て判断するのが好きだ。" },
      { id: 28, axis: "T1", text: "物事のメリット・デメリットを整理してから決めたいタイプだ。" },
      { id: 29, axis: "T1", text: "複雑な話を構造化して、図や箇条書きでまとめるのが得意だ。" },
      { id: 30, axis: "T1", text: "先のリスクや抜け漏れに、比較的早く気づく方だ。" },

      // T2 風の探究軸
      { id: 31, axis: "T2", text: "興味を持ったテーマは、ネットや本で徹底的に調べたくなる。" },
      { id: 32, axis: "T2", text: "学びのための講座や本に、お金や時間を使うことに抵抗が少ない。" },
      { id: 33, axis: "T2", text: "「なぜ？」「どういう仕組み？」と深く掘り下げて考えるのが好きだ。" },
      { id: 34, axis: "T2", text: "一度ハマった分野については、人より詳しくなりがちだ。" },
      { id: 35, axis: "T2", text: "新しい知識や考え方に触れるとワクワクする。" },
      { id: 36, axis: "T2", text: "学んだことを自分なりに整理して、メモやノートにまとめることが多い。" },

      // R1 水の共感軸
      { id: 37, axis: "R1", text: "人の表情や声のトーンから、気持ちの変化に敏感だと思う。" },
      { id: 38, axis: "R1", text: "悩んでいる人の話を聞くと、つい親身になってしまう。" },
      { id: 39, axis: "R1", text: "相手が傷つかないような言い方を選びがちだ。" },
      { id: 40, axis: "R1", text: "相談されることが多い方だ。" },
      { id: 41, axis: "R1", text: "相手の立場に立って考える癖がある。" },
      { id: 42, axis: "R1", text: "誰かが疎外されている雰囲気に気づくと、放っておけない。" },

      // R2 水のチーム軸
      { id: 43, axis: "R2", text: "一人でやるより、誰かと一緒に進める方がやる気が出る。" },
      { id: 44, axis: "R2", text: "チームのメンバーそれぞれの強みや個性を意識して見ている。" },
      { id: 45, axis: "R2", text: "役割分担やスケジュールを調整することが多い。" },
      { id: 46, axis: "R2", text: "場の空気がギスギスしていると、なんとか和らげたくなる。" },
      { id: 47, axis: "R2", text: "みんなが気持ちよく働けるように、裏でサポートするのが得意だ。" },
      { id: 48, axis: "R2", text: "会議や作業の前後に、メンバーに声をかけてフォローすることが多い。" }
    ];

    // ---- DOM ----
    const container       = document.getElementById("questionsContainer");
    const form            = document.getElementById("quizForm");
    const resultCard      = document.getElementById("resultCard");
    const resultContent   = document.getElementById("resultContent");
    const copyBtn         = document.getElementById("copyResultBtn");
    const shareBtn        = document.getElementById("shareResultBtn");
    const shareMsg        = document.getElementById("shareMessage");
    const birthDateInput  = document.getElementById("birthDate");
    const astroResultBox  = document.getElementById("astroResultBox");

    let radarChart = null;
    let elementMapChart = null;
    let latestShareText = "";
    let latestTalentElementKey = null;

    // ---- 質問描画 ----
    questions.forEach((q, index) => {
      const wrap = document.createElement("div");
      wrap.className = "question";

      const title = document.createElement("div");
      title.className = "question-title";
      title.textContent = `${index + 1}. ${q.text}`;
      wrap.appendChild(title);

      const options = document.createElement("div");
      options.className = "options";

      const labels = [
        "1：まったく当てはまらない",
        "2：あまり当てはまらない",
        "3：どちらともいえない",
        "4：かなり当てはまる",
        "5：とても当てはまる"
      ];

      for (let value = 1; value <= 5; value++) {
        const label = document.createElement("label");
        label.className = "option";
        const input = document.createElement("input");
        input.type = "radio";
        input.name = `q${q.id}`;
        input.value = value;
        label.appendChild(input);
        label.appendChild(document.createTextNode(labels[value - 1]));
        options.appendChild(label);
      }

      wrap.appendChild(options);
      container.appendChild(wrap);
    });

    // ---- 採点処理 ----
    form.addEventListener("submit", function (e) {
      e.preventDefault();

      const answers = {};
      let allAnswered = true;

      questions.forEach(q => {
        const selected = form.querySelector(`input[name="q${q.id}"]:checked`);
        if (!selected) {
          allAnswered = false;
        } else {
          answers[q.id] = Number(selected.value);
        }
      });

      if (!allAnswered) {
        alert("まだ答えていない質問があります。すべての質問に回答してください。");
        return;
      }

      // 軸ごとのスコア
      const axisScores = {};
      const axisMax = {};
      Object.keys(axes).forEach(axisId => {
        axisScores[axisId] = 0;
        axisMax[axisId] = 0;
      });

      questions.forEach(q => {
        const axisId = q.axis;
        axisScores[axisId] += answers[q.id];
        axisMax[axisId] += 5;
      });

      // ドメイン集計
      const domainScores = {};
      const domainMax = {};
      Object.values(axes).forEach(a => {
        if (!domainScores[a.domain]) {
          domainScores[a.domain] = 0;
          domainMax[a.domain] = 0;
        }
        domainScores[a.domain] += axisScores[a.id];
        domainMax[a.domain] += axisMax[a.id];
      });

      // 軸→％
      const axisResultList = Object.keys(axes).map(axisId => {
        const meta = axes[axisId];
        const raw = axisScores[axisId];
        const max = axisMax[axisId] || 1;
        const percent = Math.round(raw / max * 100);
        return {
          id: axisId,
          label: meta.label,
          domain: meta.domain,
          rawScore: raw,
          percent,
          max
        };
      }).sort((a, b) => b.percent - a.percent);

      const top3 = axisResultList.slice(0, 3);

      // ドメイン→％
      const domainResultList = Object.keys(domainScores).map(domainName => {
        const raw = domainScores[domainName];
        const max = domainMax[domainName] || 1;
        const percent = Math.round(raw / max * 100);
        return { domain: domainName, rawScore: raw, max, percent };
      }).sort((a, b) => b.percent - a.percent);

      const mainDomain = domainResultList[0];
      latestTalentElementKey = getElementKeyFromDomainName(mainDomain.domain);

      // 結果HTML
      let html = "";

      // 4エレメント
      html += `<div class="result-title">4エレメントのバランス</div>`;
      html += `<p class="small">数字が高いほど、そのエレメントの才能を今よく使っている可能性が高いです。</p>`;

      domainResultList.forEach((d, index) => {
        const color = domainColors[d.domain] || "#4b7bec";
        html += `
          <div class="axis-row">
            <div class="axis-label">
              ${index + 1}. ${d.domain}
            </div>
            <div class="axis-bar-wrap">
              <div class="axis-bar" style="width:${d.percent}%; background:${color};"></div>
            </div>
            <div class="axis-percent">${d.percent}%</div>
          </div>
        `;
      });

      const mainElementLabel = mainDomain.domain;
      html += `<p class="small">👉 あなたの<strong>メインエレメント</strong>は「<strong>${mainElementLabel}</strong>」です。</p>`;
      html += `<p class="small">${
        domainResultList.map(d =>
          `<strong>${d.domain}</strong>：${domainDescriptions[d.domain]}`
        ).join("<br>")
      }</p>`;

      // 4エレメントと8軸のつながり
      html += `<hr style="margin:14px 0;">`;
      html += `<div class="result-title">4エレメントと8軸のつながり</div>`;
      html += `<p class="small">
        各エレメントは、次の2つの軸で構成されています。<br>
        EARTH：大地のデザイン軸／大地の実行軸<br>
        FIRE：火の発信軸／火の推進軸<br>
        AIR：風の分析軸／風の探究軸<br>
        WATER：水の共感軸／水のチーム軸
      </p>`;

      // 8軸結果
      html += `<hr style="margin:14px 0;">`;
      html += `<div class="result-title">8軸の結果（上位3つが今のメイン才能）</div>`;

      axisResultList.forEach((a, index) => {
        const color = domainColors[a.domain] || "#4b7bec";
        html += `
          <div class="axis-row">
            <div class="axis-label">
              ${index + 1}. ${a.label}
              <span class="small">（${a.domain}）</span>
              ${index < 3 ? `<span class="badge">メイン才能</span>` : ""}
            </div>
            <div class="axis-bar-wrap">
              <div class="axis-bar" style="width:${a.percent}%; background:${color};"></div>
            </div>
            <div class="axis-percent">${a.percent}%</div>
          </div>
        `;
      });

      // 上位3軸の詳しいフィードバック
      html += `<hr style="margin:14px 0;">`;
      html += `<div class="result-title">上位3軸の詳しいフィードバック</div>`;
      top3.forEach(a => {
        const text = axisLongFeedback[a.id] || "";
        html += `
          <p class="small"><strong>${a.label}</strong>（${a.domain}）<br>${text}</p>
        `;
      });

      // 3つの掛け合わせメッセージ
      const comboMsg = buildTop3CombinationMessage(top3);
      html += `<p class="small"><strong>3つの掛け合わせフィードバック：</strong><br>${comboMsg}</p>`;

      // 全8軸の解説
      html += `<hr style="margin:14px 0;">`;
      html += `<div class="result-title">全8軸の解説</div>`;
      axisOrder.forEach(axisId => {
        const meta = axes[axisId];
        html += `
          <p>
            <strong>${meta.label}</strong>（${meta.domain}）<br>
            <span class="small">${axisDescriptions[axisId] || ""}</span>
          </p>
        `;
      });

      html += `<p class="small">※この結果は、あくまで「今のあなたがよく使っている才能のパターン」です。<br>しっくりくるところ・意外だったところをメモしながら、自分の経験と照らし合わせてみてください。</p>`;

      resultContent.innerHTML = html;
      resultCard.style.display = "block";

      // シェアテキスト
      let shareText = "【才能8軸診断＋エレメント結果】\n\n";
      shareText += "■ 4エレメントのバランス\n";
      domainResultList.forEach(d => {
        shareText += `・${d.domain}: ${d.percent}%\n`;
      });
      shareText += "\n■ 上位3軸\n";
      top3.forEach(a => {
        shareText += `・${a.label}（${a.domain}）: ${a.percent}%\n`;
      });
      shareText += "\n診断ツールはこちら：\n";
      shareText += window.location.href + "\n";

      latestShareText = shareText;
      shareMsg.textContent = "";

      // レーダーチャート
      const ctx = document.getElementById("domainRadar").getContext("2d");
      const labels = domainResultList.map(d => d.domain);
      const data = domainResultList.map(d => d.percent);

      if (radarChart) {
        radarChart.data.labels = labels;
        radarChart.data.datasets[0].data = data;
        radarChart.update();
      } else {
        radarChart = new Chart(ctx, {
          type: "radar",
          data: {
            labels: labels,
            datasets: [{
              label: "エレメントバランス",
              data: data,
              fill: true,
              backgroundColor: "rgba(139, 92, 246, 0.15)",
              borderColor: "rgba(139, 92, 246, 1)",
              pointBackgroundColor: "rgba(139, 92, 246, 1)"
            }]
          },
          options: {
            responsive: true,
            scales: {
              r: {
                suggestedMin: 0,
                suggestedMax: 100,
                ticks: { stepSize: 20 }
              }
            }
          }
        });
      }

      // 4エレメントマップ（重心計算）
      let totalPercent = domainResultList.reduce((sum, d) => sum + d.percent, 0);
      if (totalPercent === 0) totalPercent = 1;

      let mapX = 0;
      let mapY = 0;
      domainResultList.forEach(d => {
        const pos = elementPositions[d.domain];
        if (!pos) return;
        const weight = d.percent / totalPercent;
        mapX += pos.x * weight;
        mapY += pos.y * weight;
      });

      const mapCtx = document.getElementById("elementMap").getContext("2d");
      const mapDataPoint = { x: mapX, y: mapY };

      if (elementMapChart) {
        elementMapChart.data.datasets[0].data = [mapDataPoint];
        elementMapChart.update();
      } else {
        elementMapChart = new Chart(mapCtx, {
          type: "scatter",
          data: {
            datasets: [
              {
                label: "あなたの位置",
                data: [mapDataPoint],
                pointRadius: 6,
                pointHoverRadius: 8,
                showLine: false
              }
            ]
          },
          options: {
            responsive: true,
            scales: {
              x: {
                min: -1.2,
                max: 1.2,
                ticks: { stepSize: 1 },
                title: {
                  display: true,
                  text: "EARTH（左） ⇔ FIRE（右）"
                }
              },
              y: {
                min: -1.2,
                max: 1.2,
                ticks: { stepSize: 1 },
                title: {
                  display: true,
                  text: "FIRE（下） ⇔ AIR／WATER（上）"
                }
              }
            },
            plugins: {
              legend: { display: false }
            }
          }
        });
      }

      // 星×才能の結果更新
      updateAstroResult();

      resultCard.scrollIntoView({ behavior: "smooth" });
    });

    // シェアボタン
    copyBtn.onclick = async () => {
      if (!latestShareText) {
        shareMsg.textContent = "先に診断を完了してね。";
        return;
      }
      try {
        await navigator.clipboard.writeText(latestShareText);
        shareMsg.textContent = "結果テキストをコピーしました。好きなアプリに貼りつけて使ってね。";
      } catch (e) {
        shareMsg.textContent = "コピーに失敗しました…ブラウザによって使えない場合があります。";
      }
    };

    shareBtn.onclick = async () => {
      if (!latestShareText) {
        shareMsg.textContent = "先に診断を完了してね。";
        return;
      }
      if (navigator.share) {
        try {
          await navigator.share({
            title: "才能8軸診断 結果",
            text: latestShareText
          });
          shareMsg.textContent = "共有メニューを開きました。";
        } catch (e) {
          shareMsg.textContent = "共有がキャンセルされました。";
        }
      } else {
        shareMsg.textContent = "このブラウザは共有機能に対応していないので、コピー機能を使ってね。";
      }
    };

    // 星×才能 16タイプ表示
    function updateAstroResult() {
      if (!latestTalentElementKey) {
        astroResultBox.innerHTML = "<p>まずは上の診断で、才能8軸の結果を出してみてください。</p>";
        return;
      }

      const dateStr = birthDateInput.value;
      if (!dateStr) {
        astroResultBox.innerHTML = "<p>生年月日を入力すると、12星座と星エレメントを使った「星×才能」の結果が表示されます。</p>";
        return;
      }

      const zodiac = getZodiacFromBirthdate(dateStr);
      if (!zodiac) {
        astroResultBox.innerHTML = "<p>生年月日を正しく入力できているか確認してみてください。</p>";
        return;
      }

      const typeKey = `${latestTalentElementKey}-${zodiac.element}`;
      const typeData = talentStarTypes[typeKey];

      if (!typeData) {
        astroResultBox.innerHTML = "<p>星と才能の組み合わせ結果が見つかりませんでした。</p>";
        return;
      }

      const talentName = elementDisplayNames[latestTalentElementKey] || latestTalentElementKey;
      const starElementLabel = starElementLabels[zodiac.element] || "";
      const comboMessage = buildZodiacTalentMessage(zodiac, talentName);

      let html = "";
      html += `<p class="small">
        太陽星座：<strong>${zodiac.name}</strong><br>
        星のエレメント：<strong>${starElementLabel}</strong><br>
        才能エレメント（診断結果）：<strong>${talentName}</strong>
      </p>`;
      html += `<p class="small">🌙 12星座から見るテーマ：${zodiac.description}</p>`;
      html += `<p><strong>星と才能を合わせたタイプ：${typeData.title}</strong><br>
        <span class="small">${typeData.oneLine}</span></p>`;
      html += `<p class="small">✨ 星×才能のかけ合わせメッセージ：${comboMessage}</p>`;

      astroResultBox.innerHTML = html;
    }

    birthDateInput.addEventListener("change", () => {
      if (latestTalentElementKey) {
        updateAstroResult();
      }
    });
  </script>

</body>
</html>
