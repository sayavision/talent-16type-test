<!doctype html>
<html lang="ja">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>才能×ホロスコープ 16タイプ診断</title>
  <style>
    :root { --bg:#0b1020; --card:#111a33; --txt:#e9ecf4; --muted:#a9b2cc; --accent:#7aa2ff; }
    body { margin:0; font-family: system-ui, -apple-system, Segoe UI, Roboto, "Noto Sans JP", sans-serif; background: linear-gradient(180deg,#0b1020,#070a12); color:var(--txt); }
    .wrap { max-width: 920px; margin: 0 auto; padding: 24px; }
    .card { background: rgba(17,26,51,.92); border: 1px solid rgba(255,255,255,.08); border-radius: 16px; padding: 18px; box-shadow: 0 12px 30px rgba(0,0,0,.25); }
    h1 { font-size: 20px; margin: 0 0 10px; }
    h2 { font-size: 18px; margin: 0 0 10px; }
    p { color: var(--muted); line-height: 1.6; }
    .row { display:flex; gap:14px; flex-wrap:wrap; }
    .col { flex:1; min-width:260px; }
    .btn { background: var(--accent); color:#07102a; border:0; padding: 10px 14px; border-radius: 12px; font-weight: 700; cursor: pointer; }
    .btn.sub { background: transparent; color: var(--txt); border: 1px solid rgba(255,255,255,.14); }
    .btn:disabled { opacity:.5; cursor:not-allowed; }
    .q { margin: 16px 0 10px; font-weight: 700; }
    .opt { display:block; width:100%; text-align:left; padding: 12px 12px; margin: 10px 0; border-radius: 12px; border: 1px solid rgba(255,255,255,.12); background: rgba(255,255,255,.04); color: var(--txt); cursor:pointer; }
    .opt:hover { border-color: rgba(122,162,255,.6); }
    .pill { display:inline-block; padding:6px 10px; border-radius: 999px; border: 1px solid rgba(255,255,255,.14); color: var(--muted); font-size: 12px; }
    .resultTop { display:flex; gap:16px; align-items:center; flex-wrap:wrap; }
    .resultTop img { width: 180px; max-width: 40vw; height:auto; border-radius: 16px; border: 1px solid rgba(255,255,255,.12); background: rgba(255,255,255,.03); }
    .kvs { margin-top: 10px; }
    .kvs div { margin: 6px 0; color: var(--muted); }
    .list { margin: 10px 0 0; padding-left: 18px; color: var(--muted); }
    .hr { height:1px; background: rgba(255,255,255,.10); margin: 14px 0; }
    .small { font-size: 12px; color: var(--muted); }
    input { width:100%; padding: 10px 12px; border-radius: 12px; border: 1px solid rgba(255,255,255,.14); background: rgba(255,255,255,.04); color: var(--txt); }
    label { display:block; margin: 10px 0 6px; color: var(--muted); font-size: 12px; }
  </style>
</head>

<body>
  <div class="wrap">
    <div class="card" id="screenStart">
      <h1>才能×ホロスコープ 16タイプ診断（テスト）</h1>
      <p>まずは簡易診断（サンプル）で「メインエレメント」が出る状態にしています。質問文や配点はあとで差し替えできます。</p>

      <div class="row">
        <div class="col">
          <h2>ホロスコープ（任意）</h2>
          <label>生年月日（例：1990-06-04）</label>
          <input id="birthDate" type="date" />
          <label>出生時刻（任意）</label>
          <input id="birthTime" type="time" />
          <label>出生地（任意）</label>
          <input id="birthPlace" type="text" placeholder="例：Tokyo" />
          <p class="small">※ホロスコープの本計算は後で実装可能。今は入力を結果に表示するところまで。</p>
        </div>
        <div class="col">
          <h2>スタート</h2>
          <p>準備できたら開始を押してね。</p>
          <button class="btn" id="btnStart">診断を開始</button>
          <div class="hr"></div>
          <span class="pill">画像ファイル名（同階層）</span>
          <ul class="list">
            <li>element_earth.png</li>
            <li>element_fire.png</li>
            <li>element_air.png</li>
            <li>element_water.png</li>
          </ul>
        </div>
      </div>
    </div>

    <div class="card" id="screenQuiz" style="display:none;">
      <div class="row" style="align-items:center; justify-content:space-between;">
        <div class="pill" id="progress">Q1 / Q16</div>
        <button class="btn sub" id="btnResetTop">最初から</button>
      </div>

      <div class="q" id="qText"></div>
      <div id="options"></div>

      <div class="hr"></div>
      <div class="small">※ここはサンプル質問。さやちゃんの16才能ロジックに合わせて後で差し替えOK。</div>
    </div>

    <div class="card" id="screenResult" style="display:none;">
      <h2>診断結果</h2>

      <!-- ✅結果表示の先頭にエレメント画像 -->
      <div class="resultTop">
        <img id="elementImg" src="" alt="element character" />
        <div>
          <div class="pill" id="elementLabel">ELEMENT</div>
          <h1 style="margin-top:10px;" id="elementTitle">あなたのメインエレメント：</h1>
          <div class="kvs">
            <div id="horoLine">ホロスコープ：-</div>
            <div id="scoreLine">スコア：-</div>
          </div>
        </div>
      </div>

      <div class="hr"></div>

      <h2>上位才能（サンプル）</h2>
      <ol class="list" id="topTalents"></ol>

      <div class="hr"></div>

      <div class="row">
        <button class="btn" id="btnShare">結果をシェア（全文）</button>
        <button class="btn sub" id="btnReset">もう一度診断</button>
      </div>
      <p class="small" id="shareHint" style="margin-top:10px;"></p>
    </div>
  </div>

<script>
  // =========================
  // ✅ 画像マッピング（同階層）
  // =========================
  const ELEMENT_IMAGE = {
    EARTH: "./element_earth.png",
    FIRE:  "./element_fire.png",
    AIR:   "./element_air.png",
    WATER: "./element_water.png",
  };

  // =========================
  // サンプル：16問（2択）
  // ここを後で「本物の質問配点」に差し替えOK
  // element: どのエレメントに加点するか
  // talent: 16才能のキー（仮）に加点するか
  // =========================
  const QUESTIONS = Array.from({length:16}).map((_,i)=> {
    const n = i+1;
    // 仮でぐるぐる配分
    const elements = ["EARTH","FIRE","AIR","WATER"];
    const e1 = elements[i % 4];
    const e2 = elements[(i+1) % 4];
    const t1 = "T" + String((i % 16) + 1).padStart(2,"0");
    const t2 = "T" + String(((i+7) % 16) + 1).padStart(2,"0");
    return {
      id: n,
      text: `Q${n}. 直感で近い方を選んでください（サンプル）`,
      options: [
        { label: "A：コツコツ積み上げて形にするタイプ", element: e1, talent: t1 },
        { label: "B：ひらめきや勢いで動きながら整えるタイプ", element: e2, talent: t2 },
      ]
    };
  });

  // 16才能の表示名（仮）
  const TALENT_NAME = {
    T01:"着想", T02:"達成", T03:"共感", T04:"分析",
    T05:"社交", T06:"学習", T07:"戦略", T08:"調和",
    T09:"未来", T10:"個別", T11:"責任", T12:"最上",
    T13:"活発", T14:"適応", T15:"慎重", T16:"指令",
  };

  // =========================
  // 状態
  // =========================
  let idx = 0;
  let elementScore = { EARTH:0, FIRE:0, AIR:0, WATER:0 };
  let talentScore = Object.fromEntries(Object.keys(TALENT_NAME).map(k => [k,0]));

  // =========================
  // 画面切り替え
  // =========================
  const screenStart  = document.getElementById("screenStart");
  const screenQuiz   = document.getElementById("screenQuiz");
  const screenResult = document.getElementById("screenResult");

  const progress = document.getElementById("progress");
  const qText = document.getElementById("qText");
  const optionsEl = document.getElementById("options");

  const elementImg = document.getElementById("elementImg");
  const elementLabel = document.getElementById("elementLabel");
  const elementTitle = document.getElementById("elementTitle");
  const topTalents = document.getElementById("topTalents");

  const horoLine = document.getElementById("horoLine");
  const scoreLine = document.getElementById("scoreLine");
  const shareHint = document.getElementById("shareHint");

  document.getElementById("btnStart").addEventListener("click", () => {
    resetState();
    screenStart.style.display = "none";
    screenResult.style.display = "none";
    screenQuiz.style.display = "block";
    renderQuestion();
  });

  document.getElementById("btnReset").addEventListener("click", () => location.reload());
  document.getElementById("btnResetTop").addEventListener("click", () => location.reload());

  // =========================
  // 質問表示
  // =========================
  function renderQuestion() {
    const q = QUESTIONS[idx];
    progress.textContent = `Q${idx+1} / ${QUESTIONS.length}`;
    qText.textContent = q.text;
    optionsEl.innerHTML = "";

    q.options.forEach(opt => {
      const btn = document.createElement("button");
      btn.className = "opt";
      btn.textContent = opt.label;
      btn.addEventListener("click", () => {
        // 加点
        elementScore[opt.element] = (elementScore[opt.element] || 0) + 1;
        talentScore[opt.talent] = (talentScore[opt.talent] || 0) + 1;

        // 次へ
        idx++;
        if (idx >= QUESTIONS.length) {
          showResult();
        } else {
          renderQuestion();
        }
      });
      optionsEl.appendChild(btn);
    });
  }

  // =========================
  // 結果表示（✅ここで画像を出す）
  // =========================
  function showResult() {
    screenQuiz.style.display = "none";
    screenResult.style.display = "block";

    const mainElement = pickMaxKey(elementScore);
    const elementJp = {
      EARTH:"EARTH（地）", FIRE:"FIRE（火）", AIR:"AIR（風）", WATER:"WATER（水）"
    }[mainElement] || mainElement;

    // ✅ 画像表示
    elementImg.src = ELEMENT_IMAGE[mainElement] || "";
    elementImg.alt = `${mainElement} character`;

    elementLabel.textContent = `MAIN ELEMENT：${mainElement}`;
    elementTitle.textContent = `あなたのメインエレメント：${elementJp}`;

    // スコア表示
    scoreLine.textContent = `スコア：EARTH ${elementScore.EARTH} / FIRE ${elementScore.FIRE} / AIR ${elementScore.AIR} / WATER ${elementScore.WATER}`;

    // ホロス入力を結果に反映（まずは表示だけ）
    const bd = document.getElementById("birthDate").value || "-";
    const bt = document.getElementById("birthTime").value || "-";
    const bp = document.getElementById("birthPlace").value || "-";
    horoLine.textContent = `ホロスコープ入力：生年月日=${bd} / 時刻=${bt} / 場所=${bp}`;

    // 上位才能TOP5（仮）
    const top5 = Object.entries(talentScore)
      .sort((a,b)=> b[1]-a[1])
      .slice(0,5);

    topTalents.innerHTML = "";
    top5.forEach(([k,v]) => {
      const li = document.createElement("li");
      li.textContent = `${TALENT_NAME[k] || k}（${v}）`;
      topTalents.appendChild(li);
    });

    // シェア
    document.getElementById("btnShare").onclick = () => shareResult({
      element: mainElement,
      elementScore,
      talentTop5: top5.map(([k,v]) => ({ key:k, name:(TALENT_NAME[k]||k), score:v })),
      horoscope: { birthDate: bd, birthTime: bt, birthPlace: bp },
      url: location.href
    });
  }

  function pickMaxKey(obj) {
    return Object.entries(obj).sort((a,b)=> b[1]-a[1])[0][0];
  }

  function resetState() {
    idx = 0;
    elementScore = { EARTH:0, FIRE:0, AIR:0, WATER:0 };
    talentScore = Object.fromEntries(Object.keys(TALENT_NAME).map(k => [k,0]));
  }

  // =========================
  // ✅ 結果を「全文」で共有する
  // =========================
  function buildShareText(result) {
    const lines = [];
    lines.push("【才能×ホロスコープ 16タイプ診断｜結果】");
    lines.push(`メインエレメント：${result.element}`);
    lines.push("");
    lines.push("▼上位才能TOP5");
    result.talentTop5.forEach((t,i)=>{
      lines.push(`${i+1}. ${t.name}（${t.score}）`);
    });
    lines.push("");
    lines.push(`▼ホロスコープ入力`);
    lines.push(`生年月日：${result.horoscope.birthDate}`);
    lines.push(`出生時刻：${result.horoscope.birthTime}`);
    lines.push(`出生地：${result.horoscope.birthPlace}`);
    lines.push("");
    lines.push(`診断URL：${result.url}`);
    lines.push("#能力の輪プロジェクト #才能診断");
    return lines.join("\n");
  }

  async function shareResult(result) {
    const text = buildShareText(result);
    shareHint.textContent = "";

    if (navigator.share) {
      try {
        await navigator.share({
          title: "才能×ホロスコープ 16タイプ診断結果",
          text,
          url: result.url
        });
        shareHint.textContent = "共有しました！";
        return;
      } catch (e) {
        // キャンセル等
      }
    }

    try {
      await navigator.clipboard.writeText(text);
      shareHint.textContent = "結果をコピーしました！SNS/LINEに貼り付けてシェアできます。";
    } catch (e) {
      shareHint.textContent = "コピーに失敗しました。手動でテキストを選択してコピーしてください。";
      alert(text);
    }
  }
</script>
</body>
</html>
