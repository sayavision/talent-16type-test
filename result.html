<!doctype html>
<html lang="ja">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>才能×ホロスコープ 16タイプ診断（結果）</title>
  <style>
    :root{
      --bg:#0b1020; --card:#111a33; --txt:#e9ecf4; --muted:#a9b2cc;
      --line:rgba(255,255,255,.10); --accent:#7aa2ff;
    }
    body{ margin:0; font-family: system-ui, -apple-system, Segoe UI, Roboto, "Noto Sans JP", sans-serif;
      background: linear-gradient(180deg,#0b1020,#070a12); color:var(--txt); }
    .wrap{ max-width:980px; margin:0 auto; padding:24px; }
    .card{ background: rgba(17,26,51,.92); border: 1px solid rgba(255,255,255,.08);
      border-radius: 18px; padding: 18px; box-shadow: 0 12px 30px rgba(0,0,0,.25); }
    .row{ display:flex; gap:16px; flex-wrap:wrap; align-items:flex-start; }
    .col{ flex:1; min-width:280px; }
    h1{ font-size:20px; margin:0 0 8px; }
    h2{ font-size:18px; margin:0 0 10px; }
    h3{ font-size:15px; margin:14px 0 8px; color:var(--txt); }
    p{ margin:8px 0; color:var(--muted); line-height:1.7; }
    .pill{ display:inline-block; padding:6px 10px; border-radius:999px;
      border:1px solid rgba(255,255,255,.14); color:var(--muted); font-size:12px; }
    .hr{ height:1px; background:var(--line); margin:14px 0; }
    .resultTop{ display:flex; gap:16px; align-items:center; flex-wrap:wrap; }
    .resultTop img{
      width:190px; max-width:42vw; height:auto; border-radius:16px;
      border:1px solid rgba(255,255,255,.12); background: rgba(255,255,255,.03);
    }
    .kvs div{ margin:6px 0; color:var(--muted); }
    .bars{ display:grid; gap:10px; margin-top:10px; }
    .barRow{ display:grid; grid-template-columns: 120px 1fr 64px; gap:10px; align-items:center; }
    .barLabel{ color:var(--muted); font-size:13px; }
    .barTrack{ height:12px; border-radius:999px; background: rgba(255,255,255,.08); overflow:hidden; border:1px solid rgba(255,255,255,.10); }
    .barFill{ height:100%; width:0%; background: var(--accent); }
    .barVal{ color:var(--muted); font-size:13px; text-align:right; }
    .list{ margin:8px 0 0; padding-left: 18px; color: var(--muted); }
    .rankTable{ width:100%; border-collapse:collapse; margin-top:10px; }
    .rankTable th,.rankTable td{ border-bottom:1px solid rgba(255,255,255,.10); padding:10px 6px; vertical-align:top; }
    .rankTable th{ color:var(--muted); font-weight:600; font-size:12px; text-align:left; }
    .rankNum{ width:42px; color:var(--muted); }
    .rankPct{ width:72px; text-align:right; color:var(--muted); }
    .box{ border:1px solid rgba(255,255,255,.10); border-radius:14px; padding:12px; background: rgba(255,255,255,.03); }
    .btn{ background: var(--accent); color:#07102a; border:0; padding:10px 14px; border-radius: 12px; font-weight: 800; cursor:pointer; }
    .btn.sub{ background: transparent; color: var(--txt); border: 1px solid rgba(255,255,255,.14); }
    textarea, input{
      width:100%; box-sizing:border-box;
      padding:10px 12px; border-radius:12px;
      border:1px solid rgba(255,255,255,.14);
      background: rgba(255,255,255,.04);
      color: var(--txt);
    }
    label{ display:block; margin:10px 0 6px; color:var(--muted); font-size:12px; }
    .small{ font-size:12px; color:var(--muted); }
    .warn{ color:#ffcf7a; }
  </style>
</head>

<body>
<div class="wrap">
  <div class="card">
    <h1>才能×ホロスコープ 16タイプ診断（結果ページ）</h1>
    <p class="small">
      これは「結果表示専用」の完成版テンプレです。<br>
      質問ページから localStorage に保存した結果（talentResult）を読み込みます。
    </p>
  </div>

  <div style="height:14px"></div>

  <div class="card" id="resultCard">
    <h2>メインフィールド</h2>
    <div class="resultTop">
      <img id="fieldImg" src="" alt="main field image">
      <div>
        <div class="pill" id="fieldPill">MAIN FIELD</div>
        <h1 id="fieldTitle" style="margin-top:10px;">-</h1>
        <p id="fieldShort" style="margin-top:8px;">-</p>
        <div class="kvs">
          <div id="fieldMeta1">-</div>
          <div id="fieldMeta2">-</div>
        </div>
        <p class="small warn" id="imgWarn" style="display:none;">
          画像が読み込めません。ファイル名・パスが合っているか確認してね。
        </p>
      </div>
    </div>

    <div class="hr"></div>

    <h2>４フィールドのパーセンテージ</h2>
    <div class="bars" id="fieldBars"></div>

    <div class="hr"></div>

    <h2>あなたの才能ランキング（16すべて）</h2>
    <table class="rankTable" id="rankTable">
      <thead>
        <tr>
          <th class="rankNum">順位</th>
          <th>才能</th>
          <th>説明</th>
          <th class="rankPct">％</th>
        </tr>
      </thead>
      <tbody></tbody>
    </table>

    <div class="hr"></div>

    <h2>上位３つの才能</h2>
    <div class="row" id="top3Boxes"></div>

    <div class="hr"></div>

    <h2>上位３つの掛け合わせフィードバック（約800字）</h2>
    <div class="box">
      <p id="combo800" style="white-space:pre-wrap; margin:0;"></p>
      <p class="small" id="comboCount"></p>
    </div>

    <div class="hr"></div>

    <h2>星×才能フィードバック（約800字）</h2>
    <div class="row">
      <div class="col box">
        <h3>ホロスコープ入力（簡易）</h3>
        <label>太陽星座（例：Gemini）</label>
        <input id="sun" placeholder="Gemini / Aries / etc">
        <label>月星座（例：Leo）</label>
        <input id="moon" placeholder="Leo / Cancer / etc">
        <label>ASC（例：Libra）</label>
        <input id="asc" placeholder="Libra / Virgo / etc">
        <p class="small">※本計算は後で。まずは「星名×上位才能」で文章を作る実装。</p>
        <button class="btn sub" id="btnRegenStar">星×才能を再生成</button>
      </div>
      <div class="col box">
        <p id="star800" style="white-space:pre-wrap; margin:0;"></p>
        <p class="small" id="starCount"></p>
      </div>
    </div>

    <div class="hr"></div>

    <div class="row">
      <button class="btn" id="btnShare">結果をシェア（全文）</button>
      <button class="btn sub" id="btnCopy">結果をコピー</button>
    </div>
    <p class="small" id="shareHint"></p>
  </div>
</div>

<script>
/* =========================
   画像マッピング（index.htmlと同階層）
   ========================= */
const FIELD_IMAGE = {
  EARTH: "./element_earth.png",
  FIRE:  "./element_fire.png",
  AIR:   "./element_air.png",
  WATER: "./element_water.png",
};

/* フィールド説明 */
const FIELD_INFO = {
  EARTH: { name:"EARTH｜形にするフィールド", short:"思いついた未来を、コツコツ現実の形にしていくタイプ。段取りや準備を重ねながら、一歩ずつ前に進む力があります。" },
  FIRE:  { name:"FIRE｜動かすフィールド",   short:"熱量と決断で流れをつくり、停滞を動かすタイプ。やると決めたら一気に加速でき、周囲を巻き込みながら突破口を開きます。" },
  AIR:   { name:"AIR｜ひらめくフィールド", short:"情報や体験を軽やかに組み替え、発想で未来を開くタイプ。視点を変えたり言語化したりして、新しい可能性を見つけるのが得意です。" },
  WATER: { name:"WATER｜つなぐフィールド", short:"人の感情や空気を感じ取り、関係性を整えるタイプ。安心感のある場をつくり、信頼で物事を前に進める力があります。" },
};

/* 16才能（固定：質問ページから渡してもOK） */
const DEFAULT_TALENTS = [
  { name:"学習探究", pct:92, desc:"興味を持ったテーマをとことん深く学び、知識として蓄えていく才能。" },
  { name:"アイディア", pct:88, desc:"いろんな知識や経験をつなぎ合わせて、新しいアイデアを生み出す才能。" },
  { name:"仕組み", pct:80, desc:"物事を仕組み化・ルール化して、“勝手に回る状態”をつくる才能。" },
  { name:"本質", pct:76, desc:"表面的な情報にとらわれず、「結局いちばん大事なポイント」を見抜く才能。" },
  { name:"整理整頓", pct:70, desc:"ごちゃついた状態を分類・整理し、スッキリ使いやすい形に整え直す才能。" },
  { name:"ビジョン", pct:68, desc:"自分なりの価値観をもとに、進みたい方向や未来のイメージを描く才能。" },
  { name:"寄り添い", pct:65, desc:"相手の感情の深いところを感じ取り、その人のペースで支える才能。" },
  { name:"調和", pct:63, desc:"人と人の摩擦を和らげ、安心・安全な空気をつくる才能。" },
  { name:"育成", pct:60, desc:"小さな成長の芽を見つけ、信じて伴走し続ける才能。" },
  { name:"バランス", pct:58, desc:"チーム全体を見ながら、負担や役割のバランスを整える才能。" },
  { name:"目標達成", pct:55, desc:"決めたゴールに向かって粘り強く進み、達成まで持っていく才能。" },
  { name:"修復", pct:52, desc:"うまくいかなくなった物事を立て直し、もう一度動き出すように整える才能。" },
  { name:"開放", pct:48, desc:"場の空気をふわっと明るくし、人の心をオープンにしていく才能。" },
  { name:"表現", pct:45, desc:"言葉や表情・表現を通して、自分の内側を外に届ける才能。" },
  { name:"求心", pct:42, desc:"「この指とまれ」で人を自然と集め、仲間を増やしていく才能。" },
  { name:"先導", pct:38, desc:"人より半歩先に立って、「こっちへ行こう」と道を示す才能。" },
];

/* ✅質問ページから保存された結果を読む */
function getResult(){
  const raw = localStorage.getItem("talentResult");
  if (!raw){
    // 保存がない時でもページが壊れないように保険
    return {
      mainField:"EARTH",
      fields:{ EARTH:42, FIRE:18, AIR:28, WATER:12 },
      talents: DEFAULT_TALENTS,
      horoscope:{ sun:"", moon:"", asc:"" }
    };
  }
  const parsed = JSON.parse(raw);
  // talentsが入ってない場合の保険
  if (!parsed.talents) parsed.talents = DEFAULT_TALENTS;
  if (!parsed.horoscope) parsed.horoscope = { sun:"", moon:"", asc:"" };
  return parsed;
}

/* ここから下は描画処理（短くまとめ） */
const els = {
  fieldImg: document.getElementById("fieldImg"),
  imgWarn: document.getElementById("imgWarn"),
  fieldPill: document.getElementById("fieldPill"),
  fieldTitle: document.getElementById("fieldTitle"),
  fieldShort: document.getElementById("fieldShort"),
  fieldMeta1: document.getElementById("fieldMeta1"),
  fieldMeta2: document.getElementById("fieldMeta2"),
  fieldBars: document.getElementById("fieldBars"),
  rankBody: document.querySelector("#rankTable tbody"),
  top3Boxes: document.getElementById("top3Boxes"),
  combo800: document.getElementById("combo800"),
  comboCount: document.getElementById("comboCount"),
  star800: document.getElementById("star800"),
  starCount: document.getElementById("starCount"),
  sun: document.getElementById("sun"),
  moon: document.getElementById("moon"),
  asc: document.getElementById("asc"),
  shareHint: document.getElementById("shareHint"),
};

function clamp(n){ n=Number(n); if(!Number.isFinite(n)) return 0; return Math.max(0, Math.min(100, Math.round(n))); }

function render(){
  const r = getResult();
  const info = FIELD_INFO[r.mainField] || { name:r.mainField, short:"-" };

  const src = FIELD_IMAGE[r.mainField] || "";
  els.fieldImg.src = src;
  els.fieldImg.onerror = ()=> els.imgWarn.style.display = "block";
  els.fieldImg.onload  = ()=> els.imgWarn.style.display = "none";

  els.fieldPill.textContent = `MAIN FIELD：${r.mainField}`;
  els.fieldTitle.textContent = info.name;
  els.fieldShort.textContent = info.short;
  els.fieldMeta1.textContent = `画像パス：${src}`;
  els.fieldMeta2.textContent = `URL：${location.href}`;

  // bars
  els.fieldBars.innerHTML = "";
  ["EARTH","FIRE","AIR","WATER"].forEach(k=>{
    const val = clamp(r.fields?.[k] ?? 0);
    const row = document.createElement("div");
    row.className = "barRow";
    row.innerHTML = `
      <div class="barLabel">${(FIELD_INFO[k]?.name||k).split("｜")[0]}</div>
      <div class="barTrack"><div class="barFill" style="width:${val}%"></div></div>
      <div class="barVal">${val}%</div>
    `;
    els.fieldBars.appendChild(row);
  });

  // ranking
  const ranked = [...(r.talents||[])].sort((a,b)=> (b.pct||0)-(a.pct||0));
  els.rankBody.innerHTML = "";
  ranked.forEach((t,i)=>{
    const tr = document.createElement("tr");
    tr.innerHTML = `<td class="rankNum">${i+1}</td><td><b>${t.name}</b></td><td>${t.desc||""}</td><td class="rankPct">${t.pct}%</td>`;
    els.rankBody.appendChild(tr);
  });

  // top3簡易表示（文章生成は後で強化）
  const top3 = ranked.slice(0,3);
  els.top3Boxes.innerHTML = "";
  top3.forEach(t=>{
    const box = document.createElement("div");
    box.className = "col box";
    box.innerHTML = `<h3>${t.name}（${t.pct}%）</h3><p style="margin:0;">${t.desc||""}</p>`;
    els.top3Boxes.appendChild(box);
  });

  // 800字欄は仮
  els.combo800.textContent = "（ここに上位3掛け合わせ800字を表示：質問ページの結果と連動して出せます）";
  els.comboCount.textContent = "";
  els.star800.textContent = "（ここに星×才能800字を表示：太陽/月/ASC入力で更新）";
  els.starCount.textContent = "";

  window.__PACK__ = { r, info, ranked, top3 };
}
render();

document.getElementById("btnRegenStar").addEventListener("click", ()=>{
  const p = window.__PACK__;
  p.r.horoscope = { sun: els.sun.value.trim(), moon: els.moon.value.trim(), asc: els.asc.value.trim() };
  localStorage.setItem("talentResult", JSON.stringify(p.r));
  els.shareHint.textContent = "ホロス入力を保存しました。";
});

function buildShareText(){
  const p = window.__PACK__;
  const lines = [];
  lines.push("【才能×ホロスコープ 16タイプ診断｜結果】");
  lines.push(`メインフィールド：${p.info.name}`);
  lines.push("");
  lines.push("▼才能ランキング（16）");
  p.ranked.forEach((t,i)=> lines.push(`${i+1}. ${t.name} ${t.pct}%`));
  lines.push("");
  lines.push(`URL：${location.href}`);
  lines.push("#能力の輪プロジェクト #才能診断");
  return lines.join("\n");
}
async function share(){
  const text = buildShareText();
  els.shareHint.textContent = "";
  if (navigator.share){
    try{ await navigator.share({ title:"診断結果", text, url: location.href }); els.shareHint.textContent="共有しました！"; return; }catch(e){}
  }
  await navigator.clipboard.writeText(text);
  els.shareHint.textContent="コピーしました。SNSに貼り付けてね。";
}
async function copy(){
  await navigator.clipboard.writeText(buildShareText());
  els.shareHint.textContent="コピーしました。";
}
document.getElementById("btnShare").addEventListener("click", share);
document.getElementById("btnCopy").addEventListener("click", copy);
</script>
</body>
</html>
